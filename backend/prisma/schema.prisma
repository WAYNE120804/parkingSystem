generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  CASHIER
  GUARD
}

enum VehicleType {
  CAR
  MOTO
}

enum MovementStatus {
  IN
  OUT
  CANCELED
}

enum PaymentMethod {
  CASH
  CARD
  TRANSFER
  NEQUI
  DAVIPLATA
}

model User {
  idUser     Int      @id @default(autoincrement())
  nameUser   String
  roleUser   UserRole
  isActive       Boolean          @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  entryMovements Movement[] @relation("EntryUser")
  exitMovements  Movement[] @relation("ExitUser")
  payments       Payment[]
}

model Vehicle {
  idVehicle     Int      @id @default(autoincrement())
  plateVehicle  String   @unique
  typeVehicle   VehicleType
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  movements Movement[]
}

model Movement {
  idMovement   Int            @id @default(autoincrement())
  entryTime    DateTime
  exitTime     DateTime?
  status       MovementStatus @default(IN)
  ticketNumber String?        @unique
  notes        String?

  vehicleId Int
  vehicle   Vehicle @relation(fields: [vehicleId], references: [idVehicle])

  entryUserId Int
  entryUser   User @relation("EntryUser", fields: [entryUserId], references: [idUser])

  exitUserId Int?
  exitUser   User? @relation("ExitUser", fields: [exitUserId], references: [idUser])

  payment Payment?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  idPayment   Int           @id @default(autoincrement())
  amountCents Int
  method      PaymentMethod
  paidAt      DateTime      @default(now())

  movementId Int    @unique
  movement   Movement @relation(fields: [movementId], references: [idMovement])

  paidByUserId Int
  paidByUser   User @relation(fields: [paidByUserId], references: [idUser])

  ratePerHourCents    Int
  createdAt DateTime @default(now())
}

model Rate {
  idRate             Int         @id @default(autoincrement())
  vehicleType        VehicleType @unique
  pricePerHourCents  Int

  createdAt          DateTime    @default(now())
  updatedAt          DateTime    @updatedAt
}

model ParkingInfo {
  idParkingInfo             Int      @id @default(autoincrement())
  parkingName    String
  nit            String
  address        String
  responsible    String
  footerMessage  String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
